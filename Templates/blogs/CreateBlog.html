<!DOCTYPE html>
<html lang="en">
{% load static %}

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="{% static '/assets/img/apple-icon.png' %}">
    <link rel="icon" type="image/png" href="{% static '/assets/img/favicon.png' %}">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Create Blog Post - FarmToHome</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
    
    <!-- Fonts and icons -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />
    
    <!-- CSS Files -->
    <link href="{% static '/assets/css/bootstrap.min.css' %}" rel="stylesheet" />
    <link href="{% static '/assets/css/now-ui-kit.css' %}?v=1.1.0" rel="stylesheet" />
    
    <style>
        .content-wrapper {
            padding-top: 7rem;
        }
        .card {
            margin-bottom: 20px;
        }
        .error-message {
            color: red;
            font-size: 0.8em;
            margin-top: 5px;
        }
    </style>
</head>

<body class="profile-page sidebar-collapse">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg bg-primary fixed-top navbar-transparent" color-on-scroll="400">
        <div class="container">
            <div class="navbar-translate">
                <a class="navbar-brand" href="#" rel="tooltip" title="FarmToHome Seller Dashboard" data-placement="bottom">
                    FarmToHome Seller
                </a>
                <button class="navbar-toggler navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation" 
                    aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-bar bar1"></span>
                    <span class="navbar-toggler-bar bar2"></span>
                    <span class="navbar-toggler-bar bar3"></span>
                </button>
            </div>
            <div class="collapse navbar-collapse justify-content-end" id="navigation">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'orders:seller_dashboard' %}">
                            <i class="now-ui-icons business_chart-pie-36"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'Products:sellerproductlist' %}">
                            <i class="now-ui-icons shopping_cart-simple"></i> My Products
                        </a>
                    </li>

                </ul>
            </div>
        </div>
    </nav>
    <!-- End Navbar -->

    <div class="wrapper">
        <div class="page-header page-header-small" filter-color="orange">
            <div class="page-header-image" data-parallax="true" style="background-image: url('{% static '/assets/img/bg5.jpg' %}')"></div>
            <div class="container">
                <div class="content-center">
                    <h1 class="title">Create New Blog Post</h1>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="container">
                <div class="row">
                    <div class="col-md-8 ml-auto mr-auto">
                        <form id="createBlogForm" class="contact-form" method="POST" action="{% url 'blogs:create_post' %}" enctype="multipart/form-data">
                            {% csrf_token %}
                            
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label>Blog Title</label>
                                        <input type="text" class="form-control" placeholder="Enter your blog title" name="title" id="title" required>
                                        <p class="error-message" id="title_error"></p>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label>Content</label>
                                        <textarea class="form-control" rows="8" placeholder="Share your farming journey..." name="content" id="content" required></textarea>
                                        <p class="error-message" id="content_error"></p>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label>Blog Image</label>
                                        <input type="file" class="form-control-file" name="image" id="image" accept="image/*">
                                        <p class="error-message" id="image_error"></p>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-4 ml-auto mr-auto text-center">
                                    <button type="submit" class="btn btn-primary btn-round btn-lg">Publish Post</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <footer class="footer footer-default">
        <div class="container">
            <nav>
                <ul>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Blog</a></li>
                    <li><a href="#">Contact Us</a></li>
                </ul>
            </nav>
            <div class="copyright">
                &copy; <script>document.write(new Date().getFullYear())</script>, FarmToHome. All rights reserved.
            </div>
        </div>
    </footer>

    <!--   Core JS Files   -->
    <script src="{% static '/assets/js/core/jquery.3.2.1.min.js' %}" type="text/javascript"></script>
    <script src="{% static '/assets/js/core/popper.min.js' %}" type="text/javascript"></script>
    <script src="{% static '/assets/js/core/bootstrap.min.js' %}" type="text/javascript"></script>
    <script src="{% static '/assets/js/plugins/bootstrap-switch.js' %}"></script>
    <script src="{% static '/assets/js/plugins/nouislider.min.js' %}" type="text/javascript"></script>
    <script src="{% static '/assets/js/plugins/bootstrap-datepicker.js' %}" type="text/javascript"></script>
    <script src="{% static '/assets/js/now-ui-kit.js' %}?v=1.1.0" type="text/javascript"></script>

    <script>
        $(document).ready(function() {
            function validateInput(input, errorElement, validationFunction) {
                const value = input.val().trim();
                const error = validationFunction(value);
                if (error) {
                    errorElement.text(error).css('color', 'red');
                    return false;
                } else {
                    errorElement.text('');
                    return true;
                }
            }

            function validateTitle(value) {
                if (value.length < 5 || value.length > 200) {
                    return 'Title must be between 5 and 200 characters.';
                }
                return null;
            }

            function validateContent(value) {
                if (value.length < 20) {
                    return 'Content must be at least 20 characters long.';
                }
                return null;
            }

            function validateImage(value) {
                if (value) {
                    const allowedExtensions = /(\.jpg|\.jpeg|\.png|\.gif)$/i;
                    if (!allowedExtensions.exec(value)) {
                        return 'Please upload an image file (jpg, jpeg, png, gif).';
                    }
                }
                return null;
            }

            $('#title').on('input', function() {
                validateInput($(this), $('#title_error'), validateTitle);
            });

            $('#content').on('input', function() {
                validateInput($(this), $('#content_error'), validateContent);
            });

            $('#image').on('change', function() {
                validateInput($(this), $('#image_error'), validateImage);
            });

            $('#createBlogForm').on('submit', function(e) {
                let isValid = true;

                isValid = validateInput($('#title'), $('#title_error'), validateTitle) && isValid;
                isValid = validateInput($('#content'), $('#content_error'), validateContent) && isValid;
                isValid = validateInput($('#image'), $('#image_error'), validateImage) && isValid;

                if (!isValid) {
                    e.preventDefault();
                }
            });
        });
    </script>
</body>
</html>