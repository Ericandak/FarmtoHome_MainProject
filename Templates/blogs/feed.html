<html>
{% load static %}
<body>
    <head>
        <meta charset="utf-8">
        <title>FArmToHome</title>
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta content="" name="keywords">
        <meta content="" name="description">
    
        <!-- Google Web Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link
            href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Raleway:wght@600;800&display=swap"
            rel="stylesheet">
    
        <!-- Icon Font Stylesheet -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
    
        <!-- Libraries Stylesheet -->
        <link href="{% static 'lib/lightbox/css/lightbox.min.css' %}" rel="stylesheet">
        <link href="{% static 'lib/owlcarousel/assets/owl.carousel.min.css' %}" rel="stylesheet">
    
    
        <!-- Customized Bootstrap Stylesheet -->
        <link href="{% static 'Products/css/bootstrap.min.css' %}" rel="stylesheet">
    
        <!-- Template Stylesheet -->
        <link href="{% static 'Products/css/style.css' %}" rel="stylesheet">
    <!-- Update these lines in the head section -->
    <link href="{% static 'Products/css/Chatwidget.css' %}" rel="stylesheet">
    <script src="{% static 'Products/js/Chatwidget.js' %}" defer></script>
    
        <style>
            .product-card {
                transition: all 0.3s ease;
                border: 1px solid #e0e0e0;
            }
    
            .product-card:hover {
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                transform: translateY(-5px);
            }
    
            .product-card .card-img-top {
                height: 200px;
                object-fit: cover;
            }
    
            .product-card .card-body {
                display: flex;
                flex-direction: column;
            }
    
            .product-card .card-text {
                flex-grow: 1;
            }
    
            .alert {
                border: none;
                box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            }
    
            .alert-success {
                background-color: #4CAF50;
                color: white;
            }
    
            .alert-info {
                background-color: #2196F3;
                color: white;
            }
    
            .alert-warning {
                background-color: #FFC107;
                color: #333;
            }
    
            .alert-danger {
                background-color: #F44336;
                color: white;
            }
    
            .alert .btn-close {
                filter: invert(1) grayscale(100%) brightness(200%);
            }
    
            .modal-backdrop {
                opacity: 0.5;
            }
    
            #searchModal .modal-content {
                background-color: rgba(255, 255, 255, 0.9);
                border: none;
                border-radius: 15px;
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            }
    
            #searchModal .modal-header {
                border-bottom: none;
                padding-bottom: 0;
            }
    
            #searchModal .modal-body {
                padding-top: 0;
            }
    
            #searchModal .form-control {
                border-radius: 20px 0 0 20px;
                border: 1px solid #ced4da;
            }
    
            #searchModal .btn {
                border-radius: 0 20px 20px 0;
            }
    
            #liveSearchResults {
                max-height: 300px;
                overflow-y: auto;
            }
    
            .search-item {
                display: flex;
                align-items: center;
                margin-bottom: 10px;
                padding: 5px;
                border: 1px solid #ddd;
                border-radius: 5px;
            }
    
            .search-item a {
                display: flex;
                align-items: center;
                text-decoration: none;
                color: #333;
            }
    
            .search-item img {
                margin-right: 10px;
            }
    
            .card-header a:hover img {
                opacity: 0.7;
            }
            .category-scroll-container {
        overflow-x: auto;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch; /* for smooth scrolling on iOS */
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE 10+ */
    }
    
    .category-scroll-container::-webkit-scrollbar {
        display: none; /* Chrome, Safari, Opera */
    }
    
    .category-scroll {
        display: inline-flex;
        flex-wrap: nowrap;
    }
    
    .category-scroll .nav-item {
        flex: 0 0 auto;
    }
    
    /* Optional: Add gradient fade effect to indicate more content */
    .category-scroll-container::after {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        width: 50px;
        background: linear-gradient(to right, rgba(255,255,255,0), rgba(255,255,255,1));
        pointer-events: none;
    }

    .farmer-card {
        transition: all 0.3s ease;
        border-radius: 15px;
        overflow: hidden;
        margin-bottom: 1rem;
    }

    .farmer-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .farmer-profile {
        display: flex;
        align-items: center;
        padding: 1rem;
    }

    .farmer-profile img {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
        margin-right: 1rem;
    }

    .farmer-info {
        flex-grow: 1;
    }

    .farmer-stats {
        font-size: 0.9rem;
        color: #666;
    }

    .follow-btn {
        padding: 0.25rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
    }

    .sidebar-title {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        color: #333;
        border-bottom: 2px solid #5CB85C;
        padding-bottom: 0.5rem;
    }
        </style>
    </head>

<div class="container-fluid fixed-top">
    <div class="container topbar bg-primary d-none d-lg-block">
        <div class="d-flex justify-content-between">
            <div class="top-info ps-2">
                <small class="me-3"><i class="fas fa-map-marker-alt me-2 text-secondary"></i> <a href="#"
                        class="text-white"></a></small>
                <small class="me-3"><i class="fas fa-envelope me-2 text-secondary"></i><a href="#"
                        class="text-white">Farmtohome584@gmail.com</a></small>
            </div>
            <div class="top-link pe-2">
                <a href="#" class="text-white"><small class="text-white mx-2">Privacy Policy</small>/</a>
                <a href="#" class="text-white"><small class="text-white mx-2">Terms of Use</small>/</a>
                <a href="{% url 'Delivery:jobs' %}" class="text-white"><small class="text-white ms-2">Jobs available</small></a>
            </div>
        </div>
    </div>
    <div class="container px-0">
        <nav class="navbar navbar-light bg-white navbar-expand-xl">
            <a href="{% url 'home' %}" class="navbar-brand">
                <h1 class="text-primary display-6">FarmtoHome</h1>
            </a>
            <button class="navbar-toggler py-2 px-3" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarCollapse">
                <span class="fa fa-bars text-primary"></span>
            </button>
            <div class="collapse navbar-collapse bg-white" id="navbarCollapse">
                <div class="navbar-nav mx-auto">
                    <a href="{% url 'home' %}" class="nav-item nav-link active">Home</a>
                    <a href="{% url 'blogs:feed'}" class="nav-item nav-link">Shop</a>
                    <a href="{% url 'orders:user_orders' %}" class="nav-item nav-link">My Orders</a>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Pages</a>
                        <div class="dropdown-menu m-0 bg-secondary rounded-0">
                            <a href="cart.html" class="dropdown-item">Cart</a>
                            <a href="chackout.html" class="dropdown-item">Checkout</a>
                            <a href="testimonial.html" class="dropdown-item">Testimonial</a>
                            <a href="404.html" class="dropdown-item">404 Page</a>
                        </div>
                    </div>
                    <a href="contact.html" class="nav-item nav-link">Contact</a>
                </div>
                <div class="d-flex m-3 me-0">
                    <button
                        class="btn-search btn border border-secondary btn-md-square rounded-circle bg-white me-4"
                        data-bs-toggle="modal" data-bs-target="#searchModal"><i
                            class="fas fa-search text-primary"></i></button>
                    <a href="{% url 'Products:usercart' %}" class="position-relative me-4 my-auto">
                        <i class="fa fa-shopping-bag fa-2x"></i>
                        <span
                            class="position-absolute bg-secondary rounded-circle d-flex align-items-center justify-content-center text-dark px-1"
                            style="top: -5px; left: 15px; height: 20px; min-width: 20px;">{{cart_item_count}}</span>
                    </a>
                    <div class="nav-item">
                        <a href="#" id="userAvatar" data-bs-toggle="popover" data-bs-html="true">
                            <img src="{% static 'Reg/images/user_avatar.png' %}" class="rounded-circle"
                                alt="User Avatar" style="width: 40px; height: 40px;">
                        </a>
                    </div>
                    <div id="popoverContent" class="d-none">
                        <div class="card text-center">
                            <div class="card-header p-0">
                                <a href="{% url 'profile_edit' %}" class="d-block">
                                    <img src="{% static 'Reg/images/user_avatar.png' %}" class="card-img-top"
                                        alt="User Image" style="height: 100px; object-fit: cover;">
                                </a>
                            </div>
                            <div class="card-body">
                                <h5 class="card-title">Hi, {{ username }}</h5>
                                <p class="card-text">User Role: {% if has_seller_role %}Seller{% else %}Buyer{% endif %}</p>
                                <a href="{% url 'Products:usercart' %}" class="btn btn-primary btn-sm mb-2">Cart</a>
                                <!-- {% if has_seller_role %}
                                <a href="{% url 'Products:Sellerdetails' %}" class="btn btn-primary btn-sm mb-2">Switch to
                                    Seller</a>
                                {% endif %} -->
                                <form action="{% url 'logout' %}" method="POST" class="d-inline">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-danger btn-sm">Logout</button>
                                </form><!--Temperory-->
                            </div>
                        </div>
                    </div>
                    <form action="{% url 'logout' %}" method="POST" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn-sm">Logout</button>
                    </form>
                    <!-- <form action="{% url 'logout' %}" method="POST">
                            {% csrf_token %}
                            <button type="submit">
                            </button>
                        </form> -->
                </div>
            </div>
        </nav>
    </div>
</div>
<div style="height: 90px;"></div>
<div class="container-fluid py-5 mt-5">
    <div class="container">
        <div class="row">
            <!-- Main Feed - Now 8 columns instead of 12 -->
            <div class="col-lg-8">
                <div class="row">
                    {% for post in posts %}
                    <div class="col-md-6 mb-4">
                        <div class="card shadow-sm h-100">
                            <div class="card-header bg-white d-flex align-items-center py-2">
                                <img src="{{ post.author.profile_picture.url|default:'/static/img/default-profile.png' }}" 
                                     class="rounded-circle me-2" style="width: 30px; height: 30px; object-fit: cover;">
                                <div>
                                    <h6 class="mb-0 small">{{ post.author.get_full_name }}</h6>
                                    <small class="text-muted">{{ post.created_at|timesince }} ago</small>
                                </div>
                            </div>
                            
                            {% if post.image %}
                            <a href="{% url 'blogs:post_detail' post.id %}">
                                <img src="{{ post.image.url }}" class="card-img-top" alt="{{ post.title }}"
                                     style="height: 200px; object-fit: cover;">
                            </a>
                            {% endif %}
                            
                            <div class="card-body">
                                <a href="{% url 'blogs:post_detail' post.id %}" class="text-decoration-none text-dark">
                                    <h5 class="card-title">{{ post.title }}</h5>
                                    <p class="card-text text-muted">{{ post.content|truncatewords:30 }}</p>
                                </a>
                            </div>
                            
                            <div class="card-footer bg-white">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="btn-group">
                                        <form action="{% url 'blogs:like_post' post.id %}" method="post" class="d-inline like-form">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-sm btn-outline-success {% if request.user in post.likes.all %}active{% endif %}">
                                                <i class="fas fa-heart"></i> <span class="likes-count">{{ post.likes.count }}</span>
                                            </button>
                                        </form>
                                        <a href="{% url 'blogs:post_detail' post.id %}" class="btn btn-sm btn-outline-success">
                                            <i class="fas fa-comment"></i> {{ post.comments.count }}
                                        </a>
                                    </div>
                                    <a href="{% url 'blogs:post_detail' post.id %}" class="btn btn-sm btn-primary">Read More</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body text-center">
                                <h5>No posts available</h5>
                                <p>Follow some farmers to see their posts here!</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- New Sidebar - Popular Farmers -->
            <div class="col-lg-4">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="sidebar-title">Popular Farmers</h5>
                        {% for farmer in popular_farmers %}
                        <div class="farmer-card bg-white">
                            <div class="farmer-profile">
                                <img src="{{ farmer.profile_picture.url|default:'/static/img/default-profile.png' }}" 
                                     alt="{{ farmer.get_full_name }}">
                                <div class="farmer-info">
                                    <h6 class="mb-1">{{ farmer.get_full_name }}</h6>
                                    <div class="farmer-stats">
                                        <span><i class="fas fa-seedling text-success"></i> {{ farmer.products.count }} Products</span>
                                        <span class="ms-2"><i class="fas fa-users text-success"></i> {{ farmer.followers.count }} Followers</span>
                                    </div>
                                </div>
                                <button class="btn btn-outline-success btn-sm follow-btn">
                                    {% if user in farmer.followers.all %}
                                        Unfollow
                                    {% else %}
                                        Follow
                                    {% endif %}
                                </button>
                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center py-4">
                            <i class="fas fa-users text-muted mb-3" style="font-size: 2rem;"></i>
                            <p class="text-muted">No farmers available at the moment</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Additional Sidebar Widget - Categories -->
                <div class="card shadow-sm mt-4">
                    <div class="card-body">
                        <h5 class="sidebar-title">Popular Categories</h5>
                        <div class="d-flex flex-wrap gap-2">
                            {% for category in categories %}
                            <a href="#" class="btn btn-outline-success btn-sm">
                                {{ category.name }}
                                <span class="badge bg-success ms-1">{{ category.post_count }}</span>
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'lib/easing/easing.min.js' %}"></script>
<script src="{% static 'lib/waypoints/waypoints.min.js' %}"></script>
<script src="{% static 'lib/lightbox/js/lightbox.min.js'%}"></script>
<script src="{% static 'lib/owlcarousel/owl.carousel.min.js'%}"></script>

<!-- Template Javascript -->
<script src="{% static 'js/main.js' %}"></script>
<script>
    var LIVE_SEARCH_URL = '{% url "Products:live_search" %}';
</script>
<script src="{% static 'commonjs.js' %}"></script>
<script>
    // Define the chatbot URL using Django's URL template tag
    const CHATBOT_URL = "{% url 'chatbot_message' %}";
</script>
<script src="{% static 'Products/js/voiceSearch.js' %}"></script>

<!-- Custom CSS -->
<style>
</body>
</html>
.card {
    border-radius: 15px;
    border: none;
}

.btn-success {
    background-color: #5CB85C;
    border-color: #5CB85C;
}

.btn-outline-success {
    color: #5CB85C;
    border-color: #5CB85C;
}

.btn-outline-success:hover, 
.btn-outline-success:active {
    background-color: #5CB85C;
    border-color: #5CB85C;
}
</style>

<script>
$(document).ready(function() {
    $('.like-form').on('submit', function(e) {
        e.preventDefault();
        const form = $(this);
        $.ajax({
            url: form.attr('action'),
            type: 'POST',
            data: form.serialize(),
            success: function(response) {
                const button = form.find('button');
                const likesCount = form.find('.likes-count');
                likesCount.text(response.likes_count);
                if (response.liked) {
                    button.addClass('active');
                } else {
                    button.removeClass('active');
                }
            }
        });
    });
});
</script>

